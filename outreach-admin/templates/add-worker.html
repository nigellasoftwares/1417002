{% include 'header.html' %}

 <!-- Modal -->
 <div id="worker_modal_div">

  <div id="legal_div">
    <br><br>
    <div id="legal_one" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Anda telah memilih butang “Sah” untuk status pekerja. Tolong pastikan pekerja:
        <ul>
          <li>Mempunyai dokumen <a href="#">PLKS atau PLS yang Sah.</a></li>
          <!-- <li>is working with the <a href="#">SAME EMPLOYER as stated in PLKS or JIM-endorsed PLS</a></li> -->
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Tidak</button>
      <button class="yes-btn btn btn-success" id="for_legal_two">Ya</button>
      {% else %}
      <h5>
        You have selected "Legal" as the worker's status. Please confirm the Worker:
        <ul>
          <li>has a <a href="#">valid PLKS or PLS.</a></li>
          <!-- <li>is working with the <a href="#">SAME EMPLOYER as stated in PLKS or JIM-endorsed PLS</a></li> -->
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">No</button>
      <button class="yes-btn btn btn-success" id="for_legal_two">Yes</button> 
      {% endif %}
    </div>
    

    <div id="legal_two" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Sila pastikan  <b>PEKERJA</b> adalah sama dengan pekerja yang dinyatakan  <b> didalam PLKS atau PLS yang disokong oleh JIM.</b>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Tidak</button>
      <button class="yes-btn btn btn-success" id="for_legal_three">Ya</button>
      {% else %}
      <h5>
        Please confirm the <b>CURRENT EMPLOYER</b> is the same as in Workers's <b> PLKS or PLS is endorsed by JIM.</b>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">No</button>
      <button class="yes-btn btn btn-success" id="for_legal_three">Yes</button>
      {% endif %}
    </div>
    

    <div id="legal_three" class="half-div text-center">
      {% if(session['langMalay']) == 'malay' %}
      <h5>Masukkan tarikh tamat tempoh PLKS/PLS</h5>
      <input type="date" class="form-control" name="StartDate" id="userdate">
      <br><br>
      <button class="btn btn-success" id="for_legal_four" onclick="TDate()">Hantar</button>
      {% else %}
      <h5>Enter PLKS/PLS Expiry date</h5>
      <input type="date" class="form-control" name="StartDate" id="userdate">
      <br><br>
      <button class="btn btn-success" id="for_legal_four" onclick="TDate()">Submit</button> 
      {% endif %}
    </div>


    <div id="legal_four" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Sila pastikan dokumen berikut disediakan sebelum di muatnaik:
        <br><br>
        <ul>
          <li><b>PLKS atau PLS</b></li>
          <li><b>Passport</b></li>
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Batal</button>
      <button class="yes-btn btn btn-success all_legal_cancel" >Ya</button>
      {% else %}
      <h5>
        Please ensure you have the following documents ready for upload:
        <br><br>
        <ul>
          <li><b>PLKS or PLS</b></li>
          <li><b>Passport</b></li>
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Cancel</button>
      <button class="yes-btn btn btn-success all_legal_cancel" >Yes</button>
      {% endif %}
    </div>
    
    <div id="legal_before_three_month_one" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Berikut memaparkan dokumen PLKS/PLS pekerja telah tamat tempoh. Adakah dokumen PLKS/PLS pekerja sedang di proses <b>PEMBAHARUAN?</b>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Tidak</button>
      <button class="yes-btn btn btn-success" id="for_legal_before_three_month_two">Ya</button>
      {% else %}
      <h5>
        It appears the worker's PLKS/PLS has expired. Is the PLKS/PLS in the process of <b>RENEWAL?</b>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Cancel</button>
      <button class="yes-btn btn btn-success" id="for_legal_before_three_month_two">Yes</button> 
      {% endif %}
    </div>

    <div id="legal_before_three_month_two" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Sila pastikan dokumen - dokumen berikut tersedia sebelum di muat naik:
        <br><br>
        <ul>
          <li><b>PLKS atau PLS (ATAU PLS REGULARISASI)</b></li>
          <li><b>PASSPORT</b></li>
          <li><b>AKUAN PENERIMAAN JIM, atau</b></li>
          <li><b>SURAT PENGESAHAN APS, dan</b></li>
          <li><b>SURAT PENGESAHAN MAJIKAN, dan</b></li>
          <li><b>SLIP GAJI PEKERJA</b></li>
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Batal</button>
      <button class="yes-btn btn btn-success all_legal_cancel" >Ya</button>
      {% else %}
      <h5>
        Please ensure you have the following documents ready for upload:
        <br><br>
        <ul>
          <li><b>PLKS or PLS(OR REGU)</b></li>
          <li><b>PASSPORT</b></li>
          <li><b>AKUAN PENERIMAAN JIM, or</b></li>
          <li><b>SURAT PENGESAHAN APS, and</b></li>
          <li><b>SURAT PENGESAHAN MAJIKAN, and</b></li>
          <li><b>SLIP GAJI PEKERJA</b></li>
        </ul>
      </h5>
      <br><br>
      <button class="btn btn-danger all_legal_cancel">Cancel</button>
      <button class="yes-btn btn btn-success all_legal_cancel" >Yes</button> 
      {% endif %}
    </div>
    
    <br>
    <br>
  </div>
  <!-- End -->

  <div id="illegal_div">
    <br>
    <br>
    <div id="illegal_one" class="half-div">
      {% if(session['langMalay']) == 'malay' %}
      <h5>
        Anda telah memilih butang <b>"Tidak Sah"</b> untuk status pekerja. Sila pastikan pilihan anda. 
      </h5>
      <br><br>
      <button class="btn btn-danger all_illegal_cancel">Semula</button>
      <button class="yes-btn btn btn-success" id="for_illegal_two">Ya</button>
      {% else %}
      <h5>
        You have selected "Illegal" as the Worker's status. Please confirm this is your selection 
      </h5>
      <br><br>
      <button class="btn btn-danger all_illegal_cancel">Restart</button>
      <button class="yes-btn btn btn-success" id="for_illegal_two">Yes</button>
      {% endif %}
    </div>
    <!--End illegal one-->
    <div id="illegal_two" class="half-div">
      <h6 class="text-center"> Document Listed In</h6>
      <h5 class="text-center"> <span style="color:red; border-bottom: 1px solid red;">Order of Priority</span></h5>
      <h6>-SURAT PENGESAHAN APS</h6>
      <h5 class="text-center"> <span style="color:red; border-bottom: 1px solid red;">OR </span></h5>
      <h6>-SURAT PENGESAHAN MAJIKAN</h6>
      <h5 class="text-center"> <span style="color:red; border-bottom: 1px solid red;">AND </span></h5>
      <h6>-SLIP GALI (IF AVAILABLE)</h6>
      <h5 class="text-center"> <span style="color:red; border-bottom: 1px solid red;">AND </span></h5>
      <h6>INCLUDING ANY OF THE FOLLOWING:</h6>
      <ul>
        <li><b>PASSPORT (CURRENT OR EXPIRED)</b></li>
        <li><b>PLKS (EXPIRED)</b></li>
        <li><b>PLS (EXPIRED)</b></li>
        <li><b>PPLS REGU (EXPIRED)</b></li>
        <li><b>SIJIL LAHIR (JPN)</b></li>
        <li><b>SIJIL BUKTI PENCATATAN KELAHIRAN</b></li>
        <li><b>CERTIFICATE OF LIVE BIRTH (COLB)</b></li>
        <li><b>KARTU TANDA PENDUDUK</b></li>
        <li><b>KARTU KELAURGA</b></li>
        <li><b>SIJIL NIKAH</b></li>
        <li><b>REKOD SEKOLAH</b></li>
        <li><b>FORMULIR PESERTA DIDIK</b></li>
        <li><b>REKOD KESIHATAN</b></li>
        <li><b>I-KAD</b></li>
        <li><b>OTHER DOCUMENTS</b></li>
        <li><b>NO DOCUMENTS</b></li>
      </ul>
      <br><br>
      <button class="btn btn-danger all_illegal_cancel">Cancel</button>
      <button class="yes-btn btn btn-success all_illegal_cancel" >Yes</button>
      {% if(session['langMalay']) == 'malay' %}
  
      {% else %}
        
      {% endif %}
    </div>

    <br>
    <br>
  </div>
  <!-- End -->

</div>
<!-- End Modal -->
<!-- ========= --> 






<button id="insertWorkerWithFamily" onclick="insertWorkerWithFamily()" class="btn btn-success text-white" style="position:fixed; top:1; right:0;">
  {% if(session['langMalay']) == 'malay' %}
    Simpan Maklumat Pekerja dan Ahli Keluarga
  {% else %}
    Save worker and Family Member
  {% endif %}
</button>
<br><br>
<div class="float-end mt-2" id="family_memberCont" style="position:fixed; top:0; right:0;">
  <button id="worker_registrationConBtn"  class="btn btn-dark text-white m-1">Worker</button>

</div>



<!-- Add Worker List {awl} -->
<div class="container" id="add_worker_list">
  <br>
  <!-- Worker Form -->
  <!-- *********** -->
  <!-- <form > -->
  <div>
    <div id="worker_registrationCon">
      <h4 style="font-family: roboto;">
        {% if(session['langMalay']) == 'malay' %}
          Daftar Pekerja
        {% else %}
          Worker Registration
        {% endif %}
      </h4>
      <hr>

      <!-- Worker Data-->
      <input type="hidden" id="workerData" name="workerData">
      <!-- WorkerDocs Data-->
      <input type="hidden" id="docData" name="docData">
      <!-- Worker Document Status -->
      <input type="hidden" id="workerDocsLen" name="workerDocsLen">
      <!-- Total length of family member -->
      <input type="hidden" id="familyMemberLen" name="familyMemberLen">
      <!-- family member Data -->
      <input type="hidden" id="familyMemberData" name="familyMemberData">
      <!-- FM Docs -->
      <input type="hidden" id="familyMemberDocs" name="familyMemberDocs">

     
      

    <div class="row mt-3">
      <div class="col-md-6">
        <!--
        <label for="awl_worker_registration_no">
          {% if(session['langMalay']) == 'malay' %}
            No. Pendaftaran Pekerja
          {% else %}
          Worker Registration Number
          {% endif %}
        </label>
      -->
        <!-- New Row -->
        
        <div class="row p-1">
          <div class="col-md-6">
            <input type="hidden" class="form-control col-6" id="awl_worker_registration_no" name="awl_worker_registration_no" value="{{workerRegistrationNumber}}">
            <input type="text" class="form-control" id="newRegWorNum" disabled>
         </div>
          <div class="col-md-6">
            <span class="form-control btn bg-success text-white" id="newRegistrationNumBtn">New</span>
          </div>
        </div>
      
        <script>
          $('#newRegWorNum').hide();
          $('#newRegistrationNumBtn').on('click', function(){
            function genNumber() {
              const min = 100000; // Minimum 6-digit number (100000)
              const max = 999999; // Maximum 6-digit number (999999)
              return Math.floor(Math.random() * (max - min + 1)) + min;
            }
            var newNum = genNumber();
            var newNum = `TEMP${newNum}`
            $('#newRegWorNum').val(newNum);
            $('#newRegWorNum').show()
          });
        </script>
        <!-- Enf Row -->
      </div>

      <div class="col-md-6">
        <label for="no_of_family_member">
          {% if(session['langMalay']) == 'malay' %}
          Bilangan Ahli Keluarga
          {% else %}
            No. of Family Member
          {% endif %}
        </label>
        <div class="mt-2">
          
          <span class="border rounded p-1" id="addButton"> 
            {% if(session['langMalay']) == 'malay' %}
              Tambah +
            {% else %}
              Add +
            {% endif %}
          </span>
          &nbsp;&nbsp;&nbsp;&nbsp;
          
          <span class="border rounded p-1" id="removeButton">
            {% if(session['langMalay']) == 'malay' %}
              Kurang -
            {% else %}
              Less -
            {% endif %} 
          </span>
        </div>
      </div>        
    </div>
    <!--
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_worker_legal_tatus">
              {% if(session['langMalay']) == 'malay' %}
                Status Sah Pekerja
              {% else %}
                Worker Legal Status
              {% endif %}
            </label>
            <select class="form-control" id="awl_worker_legal_status" name="awl_worker_legal_status" >
              {% if(session['langMalay']) == 'malay' %}
              <option disabled selected>Pilih</option>
              {% else %}
              <option disabled selected>select</option>
              {% endif %}
              {%for legalStatus in legalStatusList %}
                <option>{{legalStatus[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
             
          </div>
        </div>
      -->
        
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_name_of_worker">
              {% if(session['langMalay']) == 'malay' %}
                Nama Pekerja
              {% else %}
                Worker Name
              {% endif %}
            </label>
            <input type="text"  class="form-control" id="awl_name_of_worker" name="awl_name_of_worker" >
            <input type="hidden"  class="form-control" id="awl_family_name" name="awl_family_name" value="N/A">
            <input type="hidden" id="awl_worker_legal_status" name="awl_worker_legal_status" value="N/A">
            

            <script>
              $(document).ready(function(){
                $("#awl_name_of_worker").on('input', function(){
                  var workerName = $(this).val();
                  sessionStorage.setItem("worker_name", workerName);
                  $('.fm_worker_name').val(workerName);
                  $('.fm_worker_name').attr('disabled', 'disabled');
                });
              });
            </script>
          </div>
          <div class="col-md-6">
            <label for="awl_gender">
              {% if(session['langMalay']) == 'malay' %}
                Jantina
              {% else %}
                Gender
              {% endif %}
            </label>
            <select class="form-control" id="awl_gender" name="awl_gender" >
              <option selected disabled>Pilih</option>
              {%for gender in genderList %}
              <option>{{gender[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_d_o_b">
              {% if(session['langMalay']) == 'malay' %}
                Tarikh Lahir
              {% else %}
                Date of Birth
              {% endif %}
            </label>
            <input type="date"  class="form-control" id="awl_d_o_b" name="awl_d_o_b" >
          </div>
          <div class="col-md-6">
            <label for="awl_place_of_birth">
              {% if(session['langMalay']) == 'malay' %}
                Tempat Lahir
              {% else %}
                Place of Birth
              {% endif %}
            </label>
            <input type="text" class="form-control" id="awl_place_of_birth" name="awl_place_of_birth" >
          </div>
        </div>
        
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_citizenship">
              {% if(session['langMalay']) == 'malay' %}
                Kewarganegaraan
              {% else %}
                Citizenship
              {% endif %}
            </label>
            <select class="form-control" id="awl_citizenship" name="awl_citizenship" >
              <option disabled selected>Pilih</option>
              {%for citizenship in citizenshipList %}
              <option>{{citizenship[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="awl_maritial_status">
              {% if(session['langMalay']) == 'malay' %}
                Status Perkahwinan
              {% else %}
                Marital Status
              {% endif %}
            </label>
            <select class="form-control" id="awl_maritial_status" name="awl_maritial_status" >
              <option disabled selected>Pilih</option> 
              {%for maritial in maritialList %}
              <option>{{maritial[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <script>
          // Marital Status
          $(document).ready(function(){
            $('#awl_maritial_status').on('change', function(){
              let value = $(this).val()
              if (value == 'Bujang' || value == 'Duda/Janda' || value == 'Bercerai'){
                $('#awl_name_of_next_kin').prop('disabled', true);
                $('#awl_relationship').prop('disabled', true);
                $('#awl_nok_contact_no').prop('disabled', true);
                // others
                $('#awl_name_of_next_kin2').prop('disabled', false);
                $('#awl_relationship2').prop('disabled', false);
                $('#awl_nok_contact_no2').prop('disabled', false);
              }else {
                $('#awl_name_of_next_kin').prop('disabled', false);
                $('#awl_relationship').prop('disabled', false);
                $('#awl_nok_contact_no').prop('disabled', false);
                // Others 
                $('#awl_name_of_next_kin2').prop('disabled', true);
                $('#awl_relationship2').prop('disabled', true);
                $('#awl_nok_contact_no2').prop('disabled', true);
              }
            })
          })
        </script>
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_point_of_entry">
              {% if(session['langMalay']) == 'malay' %}
                Pintu Masuk
              {% else %}
                Point-of-Entry
              {% endif %}
            </label>
            
            <select class="form-control" id="awl_point_of_entry" name="awl_point_of_entry" >
              <option disabled selected>Pilih</option>
              {%for poe in poeList %}
              <option>{{poe[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="awl_religion">
              {% if(session['langMalay']) == 'malay' %}
                Agama
              {% else %}
                Religion
              {% endif %}
            </label>
            
            <select class="form-control" id="awl_religion" name="awl_religion" >
              <option disabled selected>Pilih</option>
              {%for religion in religionList %}
              <option>{{religion[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_race">
              {% if(session['langMalay']) == 'malay' %}
                Bangsa
              {% else %}
                Race
              {% endif %}
            </label>
        
            <select class="form-control" id="awl_race" name="awl_race" >
              <option disabled selected>Pilih</option>
              {%for race in raceList %}
              <option>{{race[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="awl_worker_contact_no">
              {% if(session['langMalay']) == 'malay' %}
              No. Telefon Pekerja
              {% else %}
              Worker Contact No.
              {% endif %}
            </label>
            <input type="text" class="form-control" id="awl_worker_contact_no" name="awl_worker_contact_no">
          </div>
        </div>
  
        <div class="row mt-3">
          <!--
          <div class="col-md-6">
            <label for="awl_worker_email">
              {% if(session['langMalay']) == 'malay' %}
                Emel Pekerja
              {% else %}
                Worker Email
              {% endif %}
            </label>
            <input type="email"  class="form-control" id="awl_worker_email" name="awl_worker_email" >
          </div>
          -->
          <div class="col-md-6">
            <label for="awl_name_of_next_kin">
              {% if(session['langMalay']) == 'malay' %}
                Nama Waris
              {% else %}
              Name of Next-of-Kin (NOK)
              {% endif %}
            </label>
            <input type="hidden"  class="form-control" id="awl_worker_email" name="awl_worker_email" value="N/A">
            <input type="text" class="form-control" id="awl_name_of_next_kin" name="awl_name_of_next_kin">
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_relationship">
              {% if(session['langMalay']) == 'malay' %}
              Hubungan dengan Waris
              {% else %}
              Relationship with NOK
              {% endif %}
            </label>
            
            <select class="form-control" id="awl_relationship" name="awl_relationship" >
              <option disabled selected>select</option>
              {%for relationship in relationshipList %}
              <option>{{relationship[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="awl_nok_contact_no">
              {% if(session['langMalay']) == 'malay' %}
              No. Telefon Waris
              {% else %}
                NOK Contact No.
              {% endif %}
            </label>
            <input type="text" class="form-control" id="awl_nok_contact_no" name="awl_nok_contact_no">
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_job_sector">
              {% if(session['langMalay']) == 'malay' %}
                Sektor
              {% else %}
                Sector 
              {% endif %}
            </label>
            
            <select class="form-control" id="awl_job_sector" name="awl_job_sector" >
              <option disabled selected>Pilih</option>
              {%for jobSector in jobSectorList %}
                <option value="{{jobSector[0]}}">{{jobSector[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="awl_job_sub_sector">
              {% if(session['langMalay']) == 'malay' %}
                Sub-sektor Pekerjaan
              {% else %}
                Job Sub-sector
              {% endif %}
            </label>
            <select class="form-control" id="awl_job_sub_sector" name="awl_job_sub_sector" >
              <option disabled selected>select</option>
              {%for jobSubSector in jobSubSectorList %}
              <option>{{jobSubSector[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_employement_details">
              {% if(session['langMalay']) == 'malay' %}
                Butiran Pekerjaan
              {% else %}
                Employment details
              {% endif %}
            </label>
            <input type="text"  class="form-control" id="awl_employement_details" name="awl_employement_details" >
          </div>
          <div class="col-md-6">
            <label for="awl_employement_sponsorship_status">
              {% if(session['langMalay']) == 'malay' %}
                Status Penajaan Pekerjaan
              {% else %}
                Employment Sponsorship Status
              {% endif %}
            </label>
           
            <select class="form-control" id="awl_employement_sponsorship_status" name="awl_employement_sponsorship_status" >
              <option disabled selected>Pilih</option>
              {%for jobStatusSponsor in jobStatusSponsorList %}
              <option>{{jobStatusSponsor[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_add">
              {% if(session['langMalay']) == 'malay' %}
              Nama Pekerja
              {% else %}
              Employer Name
              {% endif %}
            </label>
            <input type="text" class="form-control" value="{{aps_contact_person}}" disabled>
          </div>
        </div>
        
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_address1">
              {% if(session['langMalay']) == 'malay' %}
                Alamat 1
              {% else %}
                Address 1
              {% endif %}
            </label>
            <textarea  class="form-control" id="awl_address1" name="awl_address1">{{branch_address1}}</textarea>
          </div>
          <div class="col-md-6">
            <label for="awl_address2">
              {% if(session['langMalay']) == 'malay' %}
                Alamat 2
              {% else %}
                Address 2
              {% endif %}
            </label>
            <textarea  class="form-control" id="awl_address2" name="awl_address2">{{branch_address2}}</textarea>
          </div>
        </div>
  
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_address3">
              {% if(session['langMalay']) == 'malay' %}
                Alamat 3
              {% else %}
                Address 3 
              {% endif %}
            </label>
            <textarea  class="form-control" id="awl_address3" name="awl_address3">{{branch_address3}}</textarea>
          </div>
          <div class="col-md-6">
            <label for="awl_city">
              {% if(session['langMalay']) == 'malay' %}
                Bandar
              {% else %}
                City
              {% endif %}
            </label>
            <input type="text" value="{{branch_city}}" class="form-control" disabled>
            <input type="hidden" id="awl_city" name="awl_city" value="{{branch_city}}" class="form-control">
          </div>        
        </div>
        
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="awl_state">
              {% if(session['langMalay']) == 'malay' %}
                Negeri
              {% else %}
                State
              {% endif %}
            </label>
            <input type="text" value="{{branch_state}}" class="form-control" disabled>
            <input type="hidden" id="awl_state" name="awl_state" value="{{branch_state}}" class="form-control">
          </div>
          <div class="col-md-6">
            <label for="awl_working_status">
              {% if(session['langMalay']) == 'malay' %}
                Status Bekerja
              {% else %}
                Working Status
              {% endif %}
            </label>
            
            <select class="form-control" id="awl_working_status" name="awl_working_status" >
              <option disabled selected>select</option>
              {%for employement_status in employement_statusList %}
              <option>{{employement_status[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <br>
        
        <!--
        <br>
        {% if(session['langMalay']) == 'malay' %}
         <h5 class="text-center"><span class="border-bottom border-dark">Perincian Maklumat Dokumen</span></h5>
        {% else %}
        <h5 class="text-center"><span class="border-bottom border-dark">Document details</span></h5>
        {% endif %}
        <br>
        -->


        <!-- ******************** -->
        <!-- Auto Worker Document -->
        <!-- ******************** -->
        <div class="col-md-12 mt-5">
            Worker Document &nbsp;&nbsp;&nbsp;&nbsp;
            
            <span class="border rounded p-1" id="workerDoc_addButton"> 
              {% if(session['langMalay']) == 'malay' %}
                Tambah +
              {% else %}
                Add +
              {% endif %}
            </span>
            &nbsp;&nbsp;&nbsp;&nbsp;
            
            <span class="border rounded p-1" id="workerDoc_removeButton">
              {% if(session['langMalay']) == 'malay' %}
                Kurang -
              {% else %}
                Less -
              {% endif %} 
            </span>
            
            <span id="wDocs_add_remove_msg"></span>
            <hr>
        </div> 
        <!-- End * Add/Remove Button -->

        <div class="mt-5" id="workerDocsContainer"> </div>
        
        <div id="imageCon"></div>

        <script>
          // new function
          function fetchWorkerDocs(workerRegN, docNum, imageDataCon){
            let data = {
              q_rN: workerRegN,
              q_dN: docNum
            }

            $.ajax({
              type: "POST",
              url: '/fetch-worker-docs',
              data: JSON.stringify(data),
              contentType: "application/json",
              success: function(result) {
                let status = result.status;
                if(status == 'error'){
                  Swal.fire('fetch failure.')
                }else if(status == 'success') {
                  const imageCon = $(imageDataCon);
                  // Clear existing content
                  imageCon.empty();
                  //let imagePath = `?v=${new Date().getTime()}`;
                  let imageData = result.imageData
                  const img = `<img src="data:image/png;base64,${imageData}" alt="Image" style="width:100px;" onerror="this.onerror=null; this.src='./static/img/no-image.png'">`;
                  imageCon.append(img);   

                  /*
                  let index = 1;
                  for (let imagePath of result.imagePaths) {
                    imagePath += `?v=${new Date().getTime()}`;
                    const img = `<img src="${imagePath}" alt="Image" style="width:100px;">`;
                      
                    index++;
                    imageCon.append(img);
                  }
                  */
                } 
              }
            })
          }
          // End New Function
        </script>

<script>
  // Fetch FM Docs
  function fetch_fMemberDocs(fmRegN, docNum, imageDataCon){
    let data = {
      q_rN: fmRegN,
      q_dN: docNum
    }

    $.ajax({
      type: "POST",
      url: '/fetch-fMember-docs',
      data: JSON.stringify(data),
      contentType: "application/json",
      success: function(result) {
        let status = result.status;
        if(status == 'error'){
          Swal.fire('fetch failure.')
        }else if(status == 'success') {
          const imageCon = $(imageDataCon);
          // Clear existing content
          imageCon.empty();
          //let imagePath = `?v=${new Date().getTime()}`;
          let imageData = result.imageData
          const img = `<img src="data:image/png;base64,${imageData}" alt="Image" style="width:100px;" onerror="this.onerror=null; this.src='./static/img/no-image.png'">`;
          imageCon.append(img);  
        } 
      }
    })
  }
  // End * Fetch FM Docs
</script>
                
        <script>
          //$('#insertWorkerWithFamily').hide();
          let doc_count = 0;
            
          function workerDoc_addDiv() {
            doc_count++;
    
            if (doc_count >= 1){
              $('#workerDocsLen').val(doc_count);

              const workerDocContainer = document.getElementById("workerDocsContainer");
              
              const wDoc_div = document.createElement("div");
              wDoc_div.className = "container mt-5"; // Set the class name to match
              wDoc_div.id = "workerDocs"+doc_count;
              wDoc_div.style.display ="block";
              wDoc_div.innerHTML = `
                <div id="worker_documents_list">
                  <br><br>
                  <h6><span style="border-bottom: 1px solid rgb(37, 36, 36);">Document ${doc_count}</span></h6>
                  <div class="row mt-3">
                    <div class="col-md-6 mt-4">
                      <label for="capture_document" id="awl_capture_document${doc_count}" class='border p-1 rounded image-of-document'>
                        <span><img src="static/img/qr-code.png" style="width: 25px; height: 18px;"></span>
                        {% if(session['langMalay']) == 'malay' %}
                          Gambar Dokumen
                        {% else %}
                          Image of document
                        {% endif %}
                      </label><br>
                      <!-- <input type="text" class="form-control" id="capture_document" name="capture_document" > -->
                      <input id="qrText${doc_count}" type="hidden" value="http://{{ip_address}}:{{serverPort}}/upload-worker-docs?q_rN={{workerRegistrationNumber}}&q_dN=doc${doc_count}"><br />
                      <span id="qrCode${doc_count}"></span>
                    </div>
                    <div class="col-md-6">
                      <label for="document_details">
                        {% if(session['langMalay']) == 'malay' %}
                          Butiran Dokumen
                        {% else %}
                          Document Link
                        {% endif %}
                      </label>
                      <!-- <input type="text"  class="form-control" id="document_details" name="document_details" > -->
                      <div class="row">
                        <div>
                          <div id="imageDataCon${doc_count}"></div>
                        </div>
                      </div>
                      <!-- End link row -->
                    </div> 
                  </div>
        
        
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="type_of_documents${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Jenis Dokumen
                        {% else %}
                          Type of Documents
                        {% endif %}
                      </label>
                    
                      <select class="form-control" id="type_of_documents${doc_count}" name="type_of_documents${doc_count}" >
                        <option disabled selected>Pilih</option>
                        {%for typeOfDoc in typeOfDocList %}
                          <option>{{typeOfDoc[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  
                    <div class="col-md-6">
                      <label for="document_id${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          ID Dokumen
                        {% else %}
                          Document ID
                        {% endif %}
                      </label>
                      <input type="text" class="form-control" id="document_id${doc_count}" name="document_id${doc_count}" >
                    </div>
                  </div>
  
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="awl_place_of_issue${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Tempat Dikeluarkan
                        {% else %}
                          Place of Issue
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="awl_place_of_issue${doc_count}" name="awl_place_of_issue${doc_count}" >
                    </div>
                    <div class="col-md-6">
                      <label for="awl_document_issued_date${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Tarikh Dokumen Dikeluarkan
                        {% else %}
                          Document Issued Date
                        {% endif %}
                      </label>
                      <input type="date" class="form-control" id="awl_document_issued_date${doc_count}" name="awl_document_issued_date${doc_count}" >
                    </div>
                  </div>
          
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="awl_document_expiry_date${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Tarikh Luput Dokumen
                        {% else %}
                          Document Expiry Date
                        {% endif %}
                      </label>
                      <input type="date"  class="form-control" id="awl_document_expiry_date${doc_count}" name="awl_document_expiry_date${doc_count}" >
                    </div>
                    <div class="col-md-6">
                      <label for="awl_country_of_document_issued${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                        Negara Dokumen Dikeluarkan
                      {% else %}
                        Issuing Country
                      {% endif %}
                      </label>
                      <select class="form-control" id="awl_issuing_country${doc_count}" name="awl_issuing_country${doc_count}" >
                        <option disabled selected>select</option>
                        {%for issuingCountry in issuingCountryList %}
                          <option>{{issuingCountry[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
              
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="awl_document_status${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Status Dokumen
                        {% else %}
                          Document Status
                        {% endif %}
                      </label>
                          
                      <select class="form-control" id="awl_document_status${doc_count}" name="awl_document_status${doc_count}" >
                        <option disabled selected>Pilih</option>
                        {%for docStatus in docStatusList %}
                          <option>{{docStatus[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="awl_status_od_current_document${doc_count}">
                        {% if(session['langMalay']) == 'malay' %}
                          Status Dokumen Semasa
                        {% else %}
                          Status of Current Document
                        {% endif %}
                      </label>
                          
                      <select class="form-control" id="awl_status_of_current_document${doc_count}" name="awl_status_of_current_document${doc_count}" >
                        <option disabled selected>Pilih</option>
                        {%for curDocStatus in curDocStatusList %}
                          <option>{{curDocStatus[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                </div>  
              `;
                  
              workerDocsContainer.appendChild(wDoc_div);

              // MakeQR
              function makeQR(doc_count){
                var qrcode = new QRCode(document.getElementById("qrCode"+doc_count), {
                  width : 200,
                  height : 200
                });
                function makeCode () {		
                  var elText = document.getElementById("qrText"+doc_count);
                  if (!elText.value) {
                    //alert("Input a text");
                    elText.focus();
                    return;
                  }
                  qrcode.makeCode(elText.value);
                }
                makeCode();
                $("#qrText"+doc_count).on("blur", function () {
                    makeCode();
                }).on("keydown", function (e) {
                  if (e.keyCode == 13) {
                    makeCode();
                  }
                });
              }
              // call it
              makeQR(doc_count);

              // FM remove title
              function worker_removeTitle(fm_elementId) {
                const element = document.getElementById(fm_elementId);
                if (element) {
                    element.removeAttribute("title");
                }
              }

              // remove title
              worker_removeTitle("qrCode"+doc_count);
              // hide and show QR-code
              function makeToggle(doc_count){
                $("#qrCode"+doc_count).hide()
                $("#awl_capture_document"+doc_count).click(function(){
                  $('#qrCode'+doc_count).toggle()
                })
              }
              makeToggle(doc_count);
              // End make QR
              // ***********

              // Show Add Docs Msg
              function showMessage() {
                var msgElement = document.getElementById("wDocs_add_remove_msg");
                // new Element
                const showMessageDiv = document.createElement("span");
                showMessageDiv.className = "bg-success text-white p-2 m-3 rounded"; // Set the class name to match
                showMessageDiv.innerHTML = `
                Worker Document ${doc_count} added successfully.
                `;
                msgElement.appendChild(showMessageDiv);
                // Timer
                setTimeout(function() {
                  msgElement.innerText = '';
                }, 600);
              }
              // Example usage:
              showMessage();
              // End Show MSG

              // Fetch Docs
              let docNum = `doc${doc_count}`;
              let imageDataCon = `#imageDataCon${doc_count}`;
              setInterval(() => fetchWorkerDocs("{{workerRegistrationNumber}}", docNum, imageDataCon), 5000);
              // End * Fetch Docs
            }
            // Check Docs
          }


            
          function workerDoc_removeDiv() {
            const workerDocsContainer = document.getElementById("workerDocsContainer");
            const lastDiv = workerDocsContainer.lastChild;
            
            if (lastDiv) {
              if (doc_count >= 1){
                workerDocsContainer.removeChild(lastDiv);
                

                // Show Add Docs Msg
                function show_removeMessage(message) {
                  var msgElement = document.getElementById("wDocs_add_remove_msg");
                  // new Element
                  const showMessageDiv = document.createElement("span");
                  showMessageDiv.className = "bg-danger text-white p-2 m-3 rounded"; // Set the class name to match
                  showMessageDiv.innerHTML = `
                  Worker Document ${doc_count} removed successfully.
                  `;
                  msgElement.appendChild(showMessageDiv);
                  // Timer
                  setTimeout(function() {
                    msgElement.innerText = '';
                  }, 600);
                }
                show_removeMessage();
                // End Show MSG

                doc_count--; // Decrement the family member counter
                $('#workerDocsLen').val(doc_count);
              }
            }
          }  
          // Attach event listeners to the buttons
          const workerDoc_addButton = document.getElementById("workerDoc_addButton");
          const workerDoc_removeButton = document.getElementById("workerDoc_removeButton");
          
          workerDoc_addButton.addEventListener("click", workerDoc_addDiv);
          workerDoc_removeButton.addEventListener("click", workerDoc_removeDiv);
        </script>
        <!-- ************************** -->
        <!-- End * Auto Worker Document -->
        <!-- ************************** -->

        <div class="row mt-3" id="saveWorkerSubmitCon">
          <div class="col-md-2">
           
            <button id="insertWorker" onclick="insertWorker();" class="btn btn-primary">
              {% if(session['langMalay']) == 'malay' %}
                Simpan Data Pekerja
              {% else %}
                Save Worker
              {% endif %}
            </button>
          </div>
        </div>
        
      </div>
      <!--End OF Add Worker  -->



    <!-- Start of the Family Members -->
    <!-- *************************** -->
    <br>
    <!--
    <span class="border rounded p-3" id="addButton">Add Form</span>
    <span class="border rounded p-3" id="removeButton">Remove Form</span> -->
    <div class="mt-5" id="familyMemberContainer">
  
    </div>
    
    
    
    <script>
      $('#insertWorkerWithFamily').hide();
      let fm = 0; // Initialize the family member counter
        
      function addDiv() {
        fm++;

        if (fm <= 10){
          $('#familyMemberLen').val(fm);

          // Hide the Save Worker container
          $('#saveWorkerSubmitCon').hide();
          // End Hide Save Worker Container

          // Show Worker & Family Member
          $('#insertWorkerWithFamily').show();

          const container2 = document.getElementById("family_memberCont");
          // Old
          //const div2 = document.createElement("span");
          //div.className = "container mt-5"; // Set the class name to match
          //div2.innerHTML = `
          //    <button id="member${fm}" class="btn btn-primary border">Member ${fm}</button>
          //`;
          //container2.appendChild(div2);
          // End Old  id="member1" class="btn text-white m-1 btn-secondary"
          const div2 = document.createElement("button");
          div2.className = "btn text-white m-1 btn-primary"; // Set the class name to match
          div2.id = "member"+fm;
          div2.innerHTML = `
              Member ${fm}
          `;
          container2.appendChild(div2);


          const container = document.getElementById("familyMemberContainer");
          
          const div = document.createElement("div");
          div.className = "container mt-5"; // Set the class name to match
          div.id = "family_member"+fm;
          div.style.display ="block";
          div.innerHTML = `
                  <h4 style="font-family: roboto;">
                    {% if(session['langMalay']) == 'malay' %}
                      Ahli keluarga
                    {% else %}
                      Family member
                    {% endif %}
                      ${fm}
                  </h4>
                  <hr>
                
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <!--
                      <label for="fm_worker_registration_no">
                        {% if(session['langMalay']) == 'malay' %}
                          Nombor pendaftaran pekerja keluarga
                        {% else %}
                          Family worker registration number
                        {% endif %}
                      </label>
                      -->
                      <input type="hidden" class="form-control col-6" id="fm_worker_registration_no${fm}" name="fm_worker_registration_no">
                    
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_worker_name">
                        {% if(session['langMalay']) == 'malay' %}
                          Nama Pekerja
                        {% else %}
                          Worker Name
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control fm_worker_name" id="fm_worker_name${fm}" name="fm_worker_name" >
                      
                    </div>
                    <div class="col-md-6">
                      <label for="fm_relationship">
                        {% if(session['langMalay']) == 'malay' %}
                          Hubungan dengan Pekerja
                        {% else %}
                          Relationship to worker
                        {% endif %}
                      </label>
                      <select class="form-control" id="fm_relationship${fm}" name="fm_relationship" >
                        <option disabled selected>select</option>
                        {%for relationship in relationshipList %}
                        <option>{{relationship[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_name_of_family_member">
                        {% if(session['langMalay']) == 'malay' %}
                        Nama Ahli Keluarga
                        {% else %}
                          Name of family member
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="fm_name_of_family_member${fm}" name="fm_name_of_family_member" >
                    </div>
                    
                    <div class="col-md-6">
                      <!-- <label for="fm_family_name">
                        {% if(session['langMalay']) == 'malay' %}
                          Nama Keluarga
                        {% else %}
                          Family Name
                        {% endif %}
                      </label> -->
                      <input type="hidden"  class="form-control" id="fm_family_name${fm}" name="fm_family_name" value="N/A"> 
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_is_family_member_together">
                        {% if(session['langMalay']) == 'malay' %}
                          Tinggal Bersama?
                        {% else %}
                          Staying Together?
                        {% endif %}
                      </label>
                      <select class="form-control" id="fm_is_family_member_together${fm}" name="fm_is_family_member_together" >
                        {% if(session['langMalay']) == 'malay' %}
                          <option disabled selected>Pilih</option>
                          <option value="yes">Ya</option>
                          <option value="no">Tidak</option>
                        {% else %}
                          <option disabled selected>Select</option>
                          <option value="yes">Yes</option>
                          <option value="no">No</option>
                        {% endif %}
                        
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="fm_point_of_entry">
                        {% if(session['langMalay']) == 'malay' %}
                          Pintu Masuk
                        {% else %}
                          Point of entry
                        {% endif %}
                      </label>
                    
                      <select class="form-control" id="fm_point_of_entry${fm}" name="fm_point_of_entry" >
                        <option disabled selected>Pilih</option>
                        {%for poe in poeList %}
                        <option>{{poe[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_citizenship">
                        {% if(session['langMalay']) == 'malay' %}
                          Kewarganegaraan
                        {% else %}
                          Citizenship
                        {% endif %}
                      </label>
                      
                      <select class="form-control" id="fm_citizenship${fm}" name="fm_citizenship" >
                        <option disabled selected>Pilih</option>
                        {%for citizenship in citizenshipList %}
                        <option>{{citizenship[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="fm_religion">
                        {% if(session['langMalay']) == 'malay' %}
                          Agama
                        {% else %}
                          Religion
                        {% endif %}
                      </label>
                      
                      <select class="form-control" id="fm_religion${fm}" name="fm_religion" >
                        <option disabled selected>Pilih</option>
                        {%for religion in religionList %}
                        <option>{{religion[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_marital_status">
                        {% if(session['langMalay']) == 'malay' %}
                          Status Perkahwinan
                        {% else %}
                          Marital status
                        {% endif %}
                      </label>
                      <select class="form-control" id="fm_marital_status${fm}" name="fm_marital_status" >
                        <option disabled selected>Pilih</option>
                        {%for maritial in maritialList %}
                        <option>{{maritial[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="fm_gender">
                        {% if(session['langMalay']) == 'malay' %}
                          Jantina
                        {% else %}
                          Gender
                        {% endif %}
                      </label>
                      <select class="form-control" id="fm_gender${fm}" name="fm_gender" >
                        <option disabled selected>Pilih</option>
                        {%for gender in genderList %}
                        <option>{{gender[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>

                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_address1">
                        {% if(session['langMalay']) == 'malay' %}
                          Alamat 1
                        {% else %}
                          Address 1
                        {% endif %}
                      </label>
                      <textarea  class="form-control fm_address1" id="fm_address1${fm}" name="fm_address1">{{branch_address1}}</textarea>
                    </div>
                    <div class="col-md-6">
                      <label for="fm_address2">
                        {% if(session['langMalay']) == 'malay' %}
                          Alamat 2
                        {% else %}
                          Address 2
                        {% endif %}
                      </label>
                      <textarea  class="form-control fm_address2" id="fm_address2${fm}" name="fm_address2">{{branch_address2}}</textarea>
                    </div>
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_address3">
                        {% if(session['langMalay']) == 'malay' %}
                          Alamat 3
                        {% else %}
                          Address 3
                        {% endif %}
                      </label>
                      <textarea  class="form-control fm_address3" id="fm_address3${fm}" name="fm_address3">{{branch_address3}}</textarea>
                    </div>
                    <div class="col-md-6">
                      <label for="fm_postcode">
                        {% if(session['langMalay']) == 'malay' %}
                          Poskod
                        {% else %}
                          Postcode
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="fm_postcode${fm}" name="fm_postcode"></textarea>
                    </div>      
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_city">
                        {% if(session['langMalay']) == 'malay' %}
                          Bandar
                        {% else %}
                          Town/City
                        {% endif %}
                      </label>
                      <input type="text" value="{{branch_city}}" class="form-control" disabled>
                      <input type="hidden" value="{{branch_city}}" class="form-control" id="fm_city${fm}" name="fm_city${fm}">
                      
                      <!-- <select id="fm_city${fm}" name="fm_city${fm}" class="form-control">
                        <option disabled selected>Pilih</option>
                        {%for city in cityList %}
                        <option>{{city[0]}}</option>
                        {% endfor %}
                      </select> -->
                    </div>    
                    <div class="col-md-6">
                      <label for="fm_state">
                        {% if(session['langMalay']) == 'malay' %}
                          Negeri
                        {% else %}
                          State
                        {% endif %}
                      </label>
                      <input type="text" value="{{branch_state}}" class="form-control" disabled>
                      <input type="hidden" value="{{branch_state}}" class="form-control" id="fm_state${fm}" name="fm_state${fm}">
                      <!--
                      <select id="fm_state${fm}" name="fm_state${fm}" class="form-control">
                        <option disabled selected>Pilih</option>
                        {%for state in stateList %}
                        <option>{{state[0]}}</option>
                        {% endfor %}
                      </select>
                      -->
                    </div>    
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_contact_no">
                        {% if(session['langMalay']) == 'malay' %}
                        No. Telefon
                        {% else %}
                          Mobile contact no.
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="fm_contact_no${fm}" name="fm_contact_no" >
                    </div>
                    <div class="col-md-6">
                      <label for="fm_race">
                        {% if(session['langMalay']) == 'malay' %}
                          Bangsa
                        {% else %}
                          Race
                        {% endif %}
                      </label>
                    
                      <select class="form-control" id="fm_race${fm}" name=fm_race" >
                        <option disabled selected>Pilih</option>
                        {%for race in raceList %}
                        <option>{{race[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6">
                      <label for="fm_place_of_birth">
                        {% if(session['langMalay']) == 'malay' %}
                          Tempat Lahir
                        {% else %}
                          Place of Birth
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="fm_place_of_birth${fm}" name="fm_place_of_birth" >
                    </div>
                    <div class="col-md-6">
                      <label for="fm_dob">
                        {% if(session['langMalay']) == 'malay' %}
                          Tarikh Lahir
                        {% else %}
                          Date of Birth
                        {% endif %}
                      </label>
                      <input type="date"  class="form-control" id="fm_dob${fm}" name="fm_dob" >
                    </div>
                  </div>
            
                  <div class="row mt-3"> 
                    <div class="col-md-6">
                      <label for="fm_employment_status">
                        {% if(session['langMalay']) == 'malay' %}
                          Status Pekerjaan
                        {% else %}
                          Employment status
                        {% endif %}
                      </label>
                      
                      <select class="form-control" id="fm_employment_status${fm}" name="fm_employment_status" >
                        <option disabled selected>Pilih</option>
                        {%for employement_status in employement_statusList %}
                          <option>{{employement_status[0]}}</option>
                        {% endfor %}
                      </select>
                    </div>

                    <div class="col-md-6" id="con_fm_same_employer_as_worker${fm}">
                      <label for="fm_employer_name">
                        {% if(session['langMalay']) == 'malay' %}
                        Majikan Sama Dengan Pekerja?
                        {% else %}
                        Same Employer as Worker?
                        {% endif %}
                      </label>
                      <select class="form-control" id="fm_same_employer_as_worker${fm}" name="fm_same_employer_as_worker" >
                        {% if(session['langMalay']) == 'malay' %}
                        <option disabled selected>Pilih</option>
                        <option value="yes">Ya</option>
                        <option value="no">Tidak</option>
                        {% else %}
                        <option disabled selected>Select</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                        {% endif %}
                      </select>
                    </div>
                  </div>
            
                  <div class="row mt-3">
                    <div class="col-md-6" id="con_fm_employer_name${fm}">
                      <label for="fm_employer_name">
                        {% if(session['langMalay']) == 'malay' %}
                          Nama Majikan
                        {% else %}
                          Employer name
                        {% endif %}
                      </label>
                      <input type="text"  class="form-control" id="fm_employer_name${fm}" name="fm_employer_name" >
                    </div>
                    <div class="col-md-6" id="con_fm_employer_address${fm}">
                      <label for="fm_employer_address">
                        {% if(session['langMalay']) == 'malay' %}
                        Alamat Majikan
                        {% else %}
                          Employer address
                        {% endif %}
                      </label>
                      <textarea class="form-control" id="fm_employer_address${fm}" name="fm_employer_address" ></textarea>
                    </div>
                  </div>

                  
          <!--<script>
            // For Same Employer As Worker
            $("#fm_same_employer_as_worker{fm}").change(function(){
              var thisV = (this).val()
              if(thisV == 'yes'){
                  var workerName = ('#awl_name_of_worker').val()
                  var workerAddress = $('#awl_address1').val()
                  $('#fm_employer_name{fm}').val(workerName)
                  $('#fm_employer_address{fm}').val(workerAddress)
              }else if(thisV == 'no'){
                  var workerName = $('#awl_name_of_worker').val()
                  var workerAddress = $('#awl_address1').val()
                  $('#fm_employer_name{fm}').val("")
                  $('#fm_employer_address{fm}').val("")
              }
            })
          </script> -->






          <!--Document details for family member -->
          <br><br>
          
          
          
            <!-- Family member Submit Button -->
            <!--
            <div class="row mt-3">
              <div class="col-md-6" id="familyMemberSubmit${fm}">

                    <button id="insertWorkerWithFamily" onclick="insertWorkerWithFamily()" class="btn btn-primary bg-primary text-white">
                      {% if(session['langMalay']) == 'malay' %}
                        Simpan Maklumat Pekerja dan Ahli Keluarga
                      {% else %}
                        Save worker and Family Member
                      {% endif %}
                    </button>
                
              </div>
            </div>
            -->
            <!-- Family member Submit Button -->
            <!-- End Row -->

            <!-- ================================= -->
            <!-- Family Members Document Auto(+/-) -->
            <!-- ================================= -->
            <div class="col-md-12 mt-5">
              Family Member Document &nbsp;&nbsp;&nbsp;&nbsp;
              
              <span class="border rounded p-1" id="fMemberDoc_addButton${fm}" onclick="fMemberDoc_addDiv(${fm})"> 
                {% if(session['langMalay']) == 'malay' %}
                  Tambah +
                {% else %}
                  Add +
                {% endif %}
              </span>
              &nbsp;&nbsp;&nbsp;&nbsp;
              
              <span class="border rounded p-1" id="fMemberDoc_removeButton${fm}" onclick="fMemberDoc_removeDiv(${fm})">
                {% if(session['langMalay']) == 'malay' %}
                  Kurang -
                {% else %}
                  Less -
                {% endif %} 
              </span>
              
              <span id="fMemberDocs_add_remove_msg${fm}"></span>
              <hr>
            </div> 
            <!-- End * Add/Remove Button -->

            <div class="mt-5" id="fMemberDocsContainer${fm}">
              <input type="hidden" id="fMember_docsLen${fm}" value="0">
            </div>

            <!-- ================================= -->
            <!-- Family Members Document Auto(+/-) -->
            <!-- ================================= -->
            `;
            
            // Add Family Members
            container.appendChild(div);

            // fm_is_family_member_together
            $('#fm_address1'+fm).empty()
            $('#fm_address2'+fm).empty()
            $('#fm_address3'+fm).empty()

            $(document).ready(function() {
              function staying_together(fm){
                $('#fm_is_family_member_together'+fm).on('change', function(){
                  let staying_together = $(this).val()
                  if (staying_together == 'yes'){
                    $('#fm_address1'+fm).val("{{branch_address1}}")
                    $('#fm_address2'+fm).val("{{branch_address2}}")
                    $('#fm_address3'+fm).val("{{branch_address3}}")
                  } else if (staying_together == 'no'){
                    $('#fm_address1'+fm).val('')
                    $('#fm_address2'+fm).val('')
                    $('#fm_address3'+fm).val('')
                  }
                })
              }
              staying_together(fm);
            })
            // End * fm_is_family_member_together

            // Start * FM Employment Status 
            $(document).ready(function() {
              function employmentStatus(fm){
                $('#fm_employment_status'+fm).on('change', function(){
                  let status = $(this).val()
                  if (status == 'Tidak berkerja'){
                    $('#con_fm_same_employer_as_worker'+fm).hide()
                    $('#con_fm_employer_name'+fm).hide()
                    $('#con_fm_employer_address'+fm).hide()
                  } else {
                    $('#con_fm_same_employer_as_worker'+fm).show()
                    $('#con_fm_employer_name'+fm).show()
                    $('#con_fm_employer_address'+fm).show()
                  }
                })
              }
              employmentStatus(fm);
            })
            // End * FM Employment Status

            // Same Employer as Worker
            $('#fm_employer_name'+fm).empty()
            $('#fm_employer_address'+fm).empty()

            $(document).ready(function() {
              function sameEmployerasWorker(fm){
                $('#fm_same_employer_as_worker'+fm).on('change', function(){
                  let status = $(this).val()
                  if (status == 'yes'){
                    let emp_name = $("#awl_name_of_worker").val()
                    $('#fm_employer_name'+fm).val("{{aps_contact_person}}")
                    $('#fm_employer_address'+fm).val("{{branch_address1}}")
                  } else if (status == 'no'){
                    $('#fm_employer_name'+fm).val('')
                    $('#fm_employer_address'+fm).val('')
                  }
                })
              }
              sameEmployerasWorker(fm);
            })
            // End * Same Employer as Worker

            // Put Worker name Inside Family members
            $(document).ready(function(){
              function putWorkerName(){
                const workerName = $("#awl_name_of_worker").val()
                sessionStorage.setItem("worker_name", workerName);
                $('.fm_worker_name').val(workerName);
                $('.fm_worker_name').attr('disabled', 'disabled');
              }
              putWorkerName();
            });
            // End * Put Worker name Inside Family members
            
            // Create Family member registration numbers
            let fMemberID = "{{new_fMemberID}}"
            let new_fMemberID = parseInt(fMemberID)+fm

            //let new_fm_registrationNum = "{{fm_registrationPrefix}}" + new_fMemberID.toString().padStart(6, "0") 
            var fmRegistrationNums = {
              1: "{{fMember_regNum_1}}",
              2: "{{fMember_regNum_2}}",
              3: "{{fMember_regNum_3}}",
              4: "{{fMember_regNum_4}}",
              5: "{{fMember_regNum_5}}",
              6: "{{fMember_regNum_6}}",
              7: "{{fMember_regNum_7}}",
              8: "{{fMember_regNum_8}}",
              9: "{{fMember_regNum_9}}",
              10: "{{fMember_regNum_10}}"
            };
            
            var new_fm_registrationNum = fmRegistrationNums[fm];
            $('#fm_worker_registration_no'+fm).val(new_fm_registrationNum)
            

            // Fetch FM Docs
            // Docs 1    
            let dirPath_fm1 = new_fm_registrationNum
            let imageConID_fm1 = "#fmDocument1_link"+fm
            //setInterval(() => fetchDocs(dirPath_fm1, imageConID_fm1), 3000);
            setInterval(() => fetch_fMemberDocs(dirPath_fm1, 'doc1', imageConID_fm1), 5000)

            
            // Docs 2   
            let dirPath_fm2 = new_fm_registrationNum
            let imageConID_fm2 = "#fmDocument2_link"+fm
            //setInterval(() => fetchDocs(dirPath_fm2, imageConID_fm2), 3000);
            setInterval(() => fetch_fMemberDocs(dirPath_fm2, 'doc2', imageConID_fm2), 5000)
              
            // End Fetch FM Docs

            // Send qr value
            let fmDoc1_text_val = "http://{{ip_address}}:{{serverPort}}/upload-fMember-docs?q_rN="+ new_fm_registrationNum + "&q_dN=doc1"
            let fmDoc2_text_val = "http://{{ip_address}}:{{serverPort}}/upload-fMember-docs?q_rN="+ new_fm_registrationNum + "&q_dN=doc2"
            $('#fmDoc1_text'+fm).val(fmDoc1_text_val)
            $('#fmDoc2_text'+fm).val(fmDoc2_text_val)

            // Show the QR-code of Family members

            // End ** Show the QR-code of Family members
            // For QR1
            var qrcode = new QRCode(document.getElementById("qrcode_fmDoc1"+fm), {
              width : 200,
              height : 200
            });
            function makeCode () {		
              var elText = document.getElementById("fmDoc1_text"+fm);
              if (!elText.value) {
                alert("Input a text");
                elText.focus();
                return;
              }
              qrcode.makeCode(elText.value);
            }
            makeCode();
            $("#fmDoc1_text"+fm).on("blur", function () {
                makeCode();
            }).on("keydown", function (e) {
              if (e.keyCode == 13) {
                makeCode();
              }
            });

            // remove title
            removeTitle("qrcode_fmDoc1"+fm);

            // hide and show QR-code
            function qrToggle(fm){
              $("#qrcode_fmDoc1"+fm).hide()
              $("#fmDoc1_capture_document"+fm).click(function(){
                $('#qrcode_fmDoc1'+fm).toggle()
              })
            }
            qrToggle(fm);

            // For QR2
            function fmDoc2QR(fm){
              var qrcode = new QRCode(document.getElementById("qrcode_fmDoc2"+fm), {
                width : 200,
                height : 200
              });
              function makeCode () {		
                var elText = document.getElementById("fmDoc2_text"+fm);
                if (!elText.value) {
                  alert("Input a text");
                  elText.focus();
                  return;
                }
                qrcode.makeCode(elText.value);
              }
              makeCode();
              $("#fmDoc2_text"+fm).on("blur", function () {
                  makeCode();
              }).on("keydown", function (e) {
                if (e.keyCode == 13) {
                  makeCode();
                }
              });
            }
            fmDoc2QR(fm);

            // remove title
            removeTitle("qrcode_fmDoc2"+fm);

            // hide and show QR-code
            function qrToggle2(fm){
              $("#qrcode_fmDoc2"+fm).hide()
              $("#fmDoc2_capture_document"+fm).click(function(){
                $('#qrcode_fmDoc2'+fm).toggle()
              })
            }

            qrToggle2(fm);
            // End ** Create Family member registration numbers


            // Show Family member Submit Button
            if(fm === 1){
              $('#familyMemberSubmit1').show()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 2){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').show();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 3){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').show();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 4){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').show();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 5){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').show();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 6){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').show();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 7){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').show();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 8){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').show();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 9){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').show();
              $('#familyMemberSubmit10').hide();
            }

            if(fm === 10){
              $('#familyMemberSubmit1').hide()
              $('#familyMemberSubmit2').hide();
              $('#familyMemberSubmit3').hide();
              $('#familyMemberSubmit4').hide();
              $('#familyMemberSubmit5').hide();
              $('#familyMemberSubmit6').hide();
              $('#familyMemberSubmit7').hide();
              $('#familyMemberSubmit8').hide();
              $('#familyMemberSubmit9').hide();
              $('#familyMemberSubmit10').show();
            }
          }else{
            Swal.fire("Sorry, you can't add more than 10 family members.")
          }
        }
        
        function removeDiv() {
            const container = document.getElementById("familyMemberContainer");
            const lastDiv = container.lastChild;

            const container2 = document.getElementById("family_memberCont");
            const lastDiv2 = container2.lastChild;
            
            if (lastDiv) {
                if (fm >= 1){
                  if(fm === 1){
                    $('#saveWorkerSubmitCon').show()
                    // hide fm button
                    $('#insertWorkerWithFamily').hide();
                  }
                  container.removeChild(lastDiv);
                  container2.removeChild(lastDiv2);
                  fm--; // Decrement the family member counter
                  // FM length
                  $('#familyMemberLen').val(fm);
                } else {
                  $('#saveWorkerSubmitCon').show();
                  // hide fm button
                  $('#insertWorkerWithFamily').hide();
                }

                // Show Family member Submit Button
                if(fm === 1){
                  $('#familyMemberSubmit1').show()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 2){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').show();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 3){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').show();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 4){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').show();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 5){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').show();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 6){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').show();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 7){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').show();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 8){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').show();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 9){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').show();
                  $('#familyMemberSubmit10').hide();
                }

                if(fm === 10){
                  $('#familyMemberSubmit1').hide()
                  $('#familyMemberSubmit2').hide();
                  $('#familyMemberSubmit3').hide();
                  $('#familyMemberSubmit4').hide();
                  $('#familyMemberSubmit5').hide();
                  $('#familyMemberSubmit6').hide();
                  $('#familyMemberSubmit7').hide();
                  $('#familyMemberSubmit8').hide();
                  $('#familyMemberSubmit9').hide();
                  $('#familyMemberSubmit10').show();
                }
                
            }
        }
        
        // Attach event listeners to the buttons
        const addButton = document.getElementById("addButton");
        const removeButton = document.getElementById("removeButton");
        
        addButton.addEventListener("click", addDiv);
        removeButton.addEventListener("click", removeDiv);
    </script>
    
  <!-- </form> -->
  </div>
</div>
   
    <!-- End List of Family Member -->

  



{% include 'footer.html' %}


<script>
  // Submit All worker Data
  // ++++++++++++++++++++++

  // For Worker Form
  $('#insertWorker').click(function(){

    // Confirm box
    function showConfirmationDialog() {
      Swal.fire({
        title: 'Are you sure?',
        text: 'You are submitting worker({{workerRegistrationNumber}}).',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, proceed',
        cancelButtonText: 'No, cancel',
      }).then((result) => {
        if (result.isConfirmed) {
          // check All data
          const validateWorker_check = validateWorker();

          // Worker Check
          if (validateWorker_check){
            // Check Worker Docs
            const validateWorkerDocs_check = validateWorkerDocs();
            if (validateWorkerDocs_check){
              const workerData = $('#workerData').val();
              const docData = $('#docData').val();
              const fmLen = $('#familyMemberLen').val();
              const familyMemberData = $('#familyMemberData').val();
              const familyMemberDocs = $('#familyMemberDocs').val();

              const dataToSend = {
                status:'workerOnly',
                workerData: workerData,
                docData: docData,
                fmLen: fmLen,
                familyMemberData: familyMemberData,
                familyMemberDocs: familyMemberDocs
              };

              // send to server
              $.ajax({
                type: "POST",
                url: '/insertWorker',
                data: JSON.stringify(dataToSend),
                contentType: "application/json",
                success: function(result) {
                  let status = result.status;
                  if(status == 'failure'){
                    Swal.fire('Sorry! All fields are required, fill them carefully.')
                  }else if(status == 'success') {
                    Swal.fire('Worker created successfully.')
                    setTimeout(function() {
                      location.reload();
                    }, 2000);
                  } 
                },
                error: function(xhr, status, error) {
                  Swal.fire('Error!'); // Display error
                }
              })   
            }
            // End * Check Workers Docs
          }
          // End Doc Check
        } else if (result.dismiss === Swal.DismissReason.cancel) {
          Swal.fire('Form canceled', '', 'error');
          return false;
        }
      });
    }
    showConfirmationDialog();
    // End Confirm Box

    /*
    // check All data
    const validateWorker_check = validateWorker();

    // Worker Check
    if (validateWorker_check){
      // Check Worker Docs
      const validateWorkerDocs_check = validateWorkerDocs();
      if (validateWorkerDocs_check){
        const workerData = $('#workerData').val();
        const docData = $('#docData').val();
        const fmLen = $('#familyMemberLen').val();
        const familyMemberData = $('#familyMemberData').val();

        const dataToSend = {
          status:'workerOnly',
          workerData: workerData,
          docData: docData,
          fmLen: fmLen,
          familyMemberData: familyMemberData
        };

        // send to server
        $.ajax({
          type: "POST",
          url: '/insertWorker',
          data: JSON.stringify(dataToSend),
          contentType: "application/json",
          success: function(result) {
            let status = result.status;
            if(status == 'failure'){
              Swal.fire('Sorry! All fields are required, fill them carefully.')
            }else if(status == 'success') {
              Swal.fire('Worker created successfully.')
              setTimeout(function() {
                location.reload();
              }, 2000);
            } 
          },
          error: function(xhr, status, error) {
            Swal.fire('Error!'); // Display error
          }
        })   
      }
      // End * Check Workers Docs 
    }
    // End * Worker Check */

    


    /*
    const workerData = $('#workerData').val();
    const docData = $('#docData').val();
    const fmLen = $('#familyMemberLen').val();
    const familyMemberData = $('#familyMemberData').val();

    const dataToSend = {
      status:'workerOnly',
      workerData: workerData,
      docData: docData,
      fmLen: fmLen,
      familyMemberData: familyMemberData
    };

    // send to server
    $.ajax({
      type: "POST",
      url: '/insertWorker',
      data: JSON.stringify(dataToSend),
      contentType: "application/json",
      success: function(result) {
        let status = result.status;
        if(status == 'failure'){
          Swal.fire('Sorry! All fields are required, fill them carefully.')
        }else if(status == 'success') {
          Swal.fire('Worker created successfully.')
          setTimeout(function() {
            location.reload();
          }, 2000);
        } 
      },
      error: function(xhr, status, error) {
        Swal.fire('Error!'); // Display error
      }
    })
    */
    // End send to server
  })
  // End Worker Form
  // ===============
  // ===============================
  // For Worker & Family member Form
  // ===============================

  $('#insertWorkerWithFamily').click(function(){
    // Confirm box
    function showConfirmationDialog_FM() {
      Swal.fire({
        title: 'Are you sure?',
        text: 'You are submitting the worker({{workerRegistrationNumber}}) and their family members.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, proceed',
        cancelButtonText: 'No, cancel',
      }).then((result) => {
        if (result.isConfirmed) {
          // Check Form Data
          const validate_Worker = validateWorker();
          
          // Check Worker Fileds
          if (validate_Worker){
            const validate_WorkerDocs = validateWorkerDocs();
            // Check Worker Docs
            if (validate_WorkerDocs){
              const validate_fmData = validateFamilyMemberData();
              // Check FM Fields
              if (validate_fmData){
                const workerData = $('#workerData').val();
                const docData = $('#docData').val();
                const fmLen = $('#familyMemberLen').val();
                const familyMemberData = $('#familyMemberData').val();
                const familyMemberDocs = $('#familyMemberDocs').val();

                const dataToSend = {
                  status:'workerWithFamily',
                  workerData: workerData,
                  docData: docData,
                  fmLen: fmLen,
                  familyMemberData: familyMemberData,
                  familyMemberDocs: familyMemberDocs
                };

                // send to server
                $.ajax({
                  type: "POST",
                  url: '/insertWorker',
                  data: JSON.stringify(dataToSend),
                  contentType: "application/json",
                  success: function(result) {
                    let status = result.status;
                    if(status == 'failure'){
                      Swal.fire('Sorry! All fields are required, fill them carefully.')
                    }else if(status == 'success') {
                      Swal.fire('Worker created successfully.')
                      setTimeout(function() {
                        location.reload();
                      }, 2000);
                    } 
                  },
                  error: function(xhr, status, error) {
                    Swal.fire('Error!'); // Display error
                  }
                })
                // End send to server
              }
              // End * FM Fields
            }
            // End * Check Workers Docs
          }
          // End * Worker Fields
        }else if (result.dismiss === Swal.DismissReason.cancel) {
          Swal.fire('Form canceled', '', 'error');
          return false;
        }
      })
    }
    // call it
    showConfirmationDialog_FM();
  })
  // End Worker & Family member Form
  // End Submit All worker Data
  // ++++++++++++++++++++++++++
  
</script>















<script>
  $('#awl_job_sector').change(function(){
      var job_sector = $(this).val();
      if (job_sector) {
          $.ajax({
              type: "POST",
              url: '/add-worker-sub-sector',
              data: { job_sector: job_sector },
              success: function(result) {
                  $('#awl_job_sub_sector').empty(); 
                  $.each(result, function(index, option) {
                      $('#awl_job_sub_sector').append('<option>' + option + '</option>');
                  });
              }
          });
      }
  });
</script>


<script>
  $('#add_more_btn').click(function(){
    var awl_no_of_family_member = $('#no_of_family_member').val();
    if(awl_no_of_family_member <= 10){
      $.ajax({
        type: "POST",
        url: '/number-of-family-member',
        data: {family_member_number: awl_no_of_family_member},
        success: function(result) {
            window.console.log('Successful');
            $('#family_memberCont').load(' #family_memberCont')
            window.location.reload()
        }
      })
    }else{
      alert('Sorry, you can add max 10 members at a time.')
    }
  })
</script>
<script>
  $('#reset_btn').click(function(){
    var awl_no_of_family_member = 0
    $.ajax({
      type: "POST",
        url: '/number-of-family-member',
        data: {family_member_number: awl_no_of_family_member},
        success: function(result) {
            window.console.log('Successful');
            $('#family_memberCont').load(' #family_memberCont')
            window.location.reload()
        }
    })
  })
  // for reset btn 2
  $('#reset_btn2').click(function(){
    var awl_no_of_family_member = 0
    $.ajax({
      type: "POST",
        url: '/number-of-family-member',
        data: {family_member_number: awl_no_of_family_member},
        success: function(result) {
            window.console.log('Successful');
            $('#family_memberCont').load(' #family_memberCont')
            window.location.reload()
        }
    })
  })
</script>



<script>
  $('#awl_worker_legal_status').on('change', function(){
    let statusForm = $(this).val()

    if(statusForm == 'Legal' || statusForm == 'Another 1' || statusForm == 'Another 2' || statusForm == 'Another 3' || statusForm == 'Another 4'){
      $('#illegal_document_details').hide()
      $('#legal_document_details').show()
    }else if(statusForm == 'Illegal'){
      $('#illegal_document_details').hide()
      $('#legal_document_details').show()
      /* previous original
      $('#legal_document_details').hide()
      $('#illegal_document_details').show()
      */
    }
    
  })
</script>


<script>
  // Get Bio
  $("#getBio").click(function() {
    const getBioU = {
      Username: "SIFWuser1",
      Password: "User1SIFW2019"
    };
    
    $.ajax({
      type: "POST",
      url: 'https://103.91.65.48/SIFWAPI/AuthenticateUser',
      data: JSON.stringify(getBioU), 
      contentType: "application/json",
      beforeSend: function(x) {
        x.withCredentials = false
        if (x && x.overrideMimeType){
          x.overrideMimeType("application/j-son;charset=UTF-8")
        }
      },
      success: function(response) {
        console.log(response);
      },
      error: function(xhr, status, error) {
        console.log(status)
      }
    });
    

  });
</script>




<script>
  // add FM Docs
  function fMemberDoc_addDiv(fm) {
    fm_doc = $("#fMember_docsLen"+ fm).val();
    fm_doc++;
    //alert(fm_doc)

    $("#fMember_docsLen"+ fm).val(fm_doc)

    const fmDocContainer = document.getElementById("fMemberDocsContainer"+ fm);
    
    const new_fmDocs = document.createElement("div");
    new_fmDocs.className = "container mt-5"; // Set the class name to match
    new_fmDocs.id = "fMemberDocs"+ fm;
    new_fmDocs.style.display ="block";
    new_fmDocs.innerHTML = `
      <div id="worker_documents_list">
        <br><br>
        <h6><span style="border-bottom: 1px solid rgb(37, 36, 36);">Document ${fm_doc}</span></h6>
        <div class="row mt-3">
          <div class="col-md-6 mt-4">
            <label for="capture_document" id="fm_capture_document${fm}${fm_doc}" class='border p-1 rounded image-of-document'>
              <span><img src="static/img/qr-code.png" style="width: 25px; height: 18px;"></span>
              {% if(session['langMalay']) == 'malay' %}
                Gambar Dokumen
              {% else %}
                Image of document
              {% endif %}
            </label><br>
            <!-- <input type="text" class="form-control" id="capture_document" name="capture_document" > -->
            <input id="fm_qrText${fm}${fm_doc}" type="hidden"><br />
            <span id="fm_qrCode${fm}${fm_doc}"></span>
          </div>
          <div class="col-md-6">
            <label for="document_details">
              {% if(session['langMalay']) == 'malay' %}
                Butiran Dokumen
              {% else %}
                Document Link
              {% endif %}
            </label>
            <!-- <input type="text"  class="form-control" id="document_details" name="document_details" > -->
            <div class="row">
              <div>
                <div id="fm_imageDataCon${fm}${fm_doc}"></div>
              </div>
            </div>
            <!-- End link row -->
          </div> 
        </div>


        <div class="row mt-3">
          <div class="col-md-6">
            <label for="fm_type_of_documents${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Jenis Dokumen
              {% else %}
                Type of Documents
              {% endif %}
            </label>
          
            <select class="form-control" id="fm_type_of_documents${fm}${fm_doc}">
              <option disabled selected>Pilih</option>
              {%for typeOfDoc in typeOfDocList %}
                <option>{{typeOfDoc[0]}}</option>
              {% endfor %}
            </select>
          </div>
        
          <div class="col-md-6">
            <label for="fm_document_id${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                ID Dokumen
              {% else %}
                Document ID
              {% endif %}
            </label>
            <input type="text" class="form-control" id="fm_document_id${fm}${fm_doc}">
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <label for="fm_place_of_issue${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Tempat Dikeluarkan
              {% else %}
                Place of Issue
              {% endif %}
            </label>
            <input type="text"  class="form-control" id="fm_place_of_issue${fm}${fm_doc}">
          </div>
          <div class="col-md-6">
            <label for="fm_document_issued_date${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Tarikh Dokumen Dikeluarkan
              {% else %}
                Document Issued Date
              {% endif %}
            </label>
            <input type="date" class="form-control" id="fm_document_issued_date${fm}${fm_doc}">
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <label for="fm_document_expiry_date${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Tarikh Luput Dokumen
              {% else %}
                Document Expiry Date
              {% endif %}
            </label>
            <input type="date"  class="form-control" id="fm_document_expiry_date${fm}${fm_doc}">
          </div>
          <div class="col-md-6">
            <label for="fm_country_of_document_issued${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
              Negara Dokumen Dikeluarkan
            {% else %}
              Issuing Country
            {% endif %}
            </label>
            <select class="form-control" id="fm_issuing_country${fm}${fm_doc}">
              <option disabled selected>select</option>
              {%for issuingCountry in issuingCountryList %}
                <option>{{issuingCountry[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
    
        <div class="row mt-3">
          <div class="col-md-6">
            <label for="fm_document_status${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Status Dokumen
              {% else %}
                Document Status
              {% endif %}
            </label>
                
            <select class="form-control" id="fm_document_status${fm}${fm_doc}">
              <option disabled selected>Pilih</option>
              {%for docStatus in docStatusList %}
                <option>{{docStatus[0]}}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label for="fm_status_od_current_document${fm}${fm_doc}">
              {% if(session['langMalay']) == 'malay' %}
                Status Dokumen Semasa
              {% else %}
                Status of Current Document
              {% endif %}
            </label>
                
            <select class="form-control" id="fm_status_of_current_document${fm}${fm_doc}">
              <option disabled selected>Pilih</option>
              {%for curDocStatus in curDocStatusList %}
                <option>{{curDocStatus[0]}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>  
    `;
        
    fmDocContainer.appendChild(new_fmDocs);

    // Send qr value
    let new_memberId = $('#fm_worker_registration_no'+ fm).val()
    //alert(new_memberId)
    let fmDoc_text_val = `http://{{ip_address}}:{{serverPort}}/upload-fMember-docs?q_rN=${new_memberId}&q_dN=doc${fm_doc}`
    $('#fm_qrText'+fm+fm_doc).val(fmDoc_text_val)

    // MakeQR
    function fm_makeQR(doc_count){
      var qrcode = new QRCode(document.getElementById("fm_qrCode"+doc_count), {
        width : 200,
        height : 200
      });
      function makeCode () {		
        var elText = document.getElementById("fm_qrText"+doc_count);
        if (!elText.value) {
          //alert("Input a text");
          elText.focus();
          return;
        }
        qrcode.makeCode(elText.value);
      }
      makeCode();
      $("#fm_qrText"+doc_count).on("blur", function () {
          makeCode();
      }).on("keydown", function (e) {
        if (e.keyCode == 13) {
          makeCode();
        }
      });
    }
    // call it
    fm_makeQR(`${fm}${fm_doc}`);

    // FM remove title
    function fm_removeTitle(fm_elementId) {
      const element = document.getElementById(fm_elementId);
      if (element) {
          element.removeAttribute("title");
      }
    }
    // remove title
    fm_removeTitle(`fm_qrCode${fm}${fm_doc}`);

    // hide and show QR-code
    function fm_makeToggle(doc_count){
      $("#fm_qrCode"+doc_count).hide()
      $("#fm_capture_document"+doc_count).click(function(){
        $('#fm_qrCode'+doc_count).toggle()
      })
    }
    fm_makeToggle(`${fm}${fm_doc}`);

    fetch_fMemberDocs

    // Show Add Docs Msg
    function fm_showMessage() {
      var msgElement = document.getElementById("fMemberDocs_add_remove_msg"+ fm);
      // new Element
      const showMessageDiv = document.createElement("span");
      showMessageDiv.className = "bg-success text-white p-2 m-3 rounded"; // Set the class name to match
      showMessageDiv.innerHTML = `
      Family Member Document ${fm_doc} added successfully.
      `;
      msgElement.appendChild(showMessageDiv);
      // Timer
      setTimeout(function() {
        msgElement.innerText = '';
      }, 500);
    }
    // Example usage:
    fm_showMessage();
    // End Show MSG

    // Fetch Docs
    let docNum = `doc${fm_doc}`;
    let imageDataCon = `#fm_imageDataCon${fm}${doc_count}`;
    setInterval(() => fetch_fMemberDocs(new_memberId, docNum, imageDataCon), 5000);
    // End * Fetch Docs
  }




  // Remove FM Docs
  function fMemberDoc_removeDiv(fm) {
    const fmDocContainer = document.getElementById("fMemberDocsContainer"+ fm);
    const lastDiv = fmDocContainer.lastChild;

    fm_doc = $("#fMember_docsLen"+ fm).val();
    //fm_doc++;
    //alert(fm_doc)

    
    if (lastDiv) {
      if (fm_doc >= 1){
        fmDocContainer.removeChild(lastDiv);
        
        
        // Show Add Docs Msg
        function fm_removeMessage() {
          var msgElement = document.getElementById("fMemberDocs_add_remove_msg" + fm);
          // new Element
          const showMessageDiv = document.createElement("span");
          showMessageDiv.className = "bg-danger text-white p-2 m-3 rounded"; // Set the class name to match
          showMessageDiv.innerHTML = `
          Family Member Document ${fm_doc} removed successfully.
          `;
          msgElement.appendChild(showMessageDiv);
          // Timer
          setTimeout(function() {
            msgElement.innerText = '';
          }, 600);
        }
        fm_removeMessage();
        // End Show MSG
        
        fm_doc--; // Decrement the family member counter
        $("#fMember_docsLen"+ fm).val(fm_doc)
        //alert(fm_doc)
      }
    }
  }
</script>
